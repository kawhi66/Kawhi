---
title: 前端工程化实践（一）
date: 2019-04-14 19:11:33
tags: ARWEN
---

最近几个月一直投入在公司一个 PC 端的 Web 项目上。在客户端部分，研发中心提供了基于 [Vue](https://cn.vuejs.org/) 的一个组件库 [h_ui](https://www.npmjs.com/package/h_ui) 和配套运行的模板工程作为解决方案。从这段儿时间的体验来看，可以很明显的感觉到，一个传统的金融软件公司想做技术的转型还是要颇费一些周章的，即便是对核心的研发部门来说，与优秀的互联网企业相比也还有很远的距离。针对 [h_ui](https://www.npmjs.com/package/h_ui) 项目在工程管理方面的一些表现，我想更好的解决方案是通过当下非常流行的脚手架来实现。

# 简介

[Arwen](https://www.npmjs.com/package/@arwen/arwen-cli) 是前端工程化的一个实践项目，目前的 [arwen](https://www.npmjs.com/package/@arwen/arwen-cli) 完全可以处理基于 [h_ui](https://www.npmjs.com/package/h_ui) 的模板工程所开发的大部分单入口的项目。[Arwen](https://www.npmjs.com/package/@arwen/arwen-cli) 只有四个核心的命令，使用非常简单但却覆盖了应用管理的全生命周期，包括创建、编译、集成和部署。近乎傻瓜式的方式可以更好的屏蔽对业务编码无关紧要的部分，从而提高开发者的效率。截止本文，[Arwen](https://www.npmjs.com/package/@arwen/arwen-cli) 的最新版本是 0.1.3，要求 Node 的版本 >= 10.X，可以通过 `npm install -gd @arwen/arwen-cli` 进行全局的安装。

# 项目创建

脚手架安装完成之后，执行 `arwen create h_ui-demo` 即可创建一个名为 h_ui-demo 的前端工程，在创建过程中，脚手架会自动完成目录检查，模板引入，依赖安装等工作，并以友好的方式给出每一步的安装提示。如图：

![](/install.png)

需要注意的是，当网络环境较差时，安装过程可能要长一些。在安装完成之后，h_ui-demo 的目录结构如下：

```javascript
./h_ui-demo/
├── README.md
├── index.html
├── sysconfig.js
├── src
│   ├── App.vue
│   ├── main.js
│   ├── api
│   ├── assets
│   ├── components
│   ├── directive
│   ├── mixins
│   ├── mock
│   ├── router
│   ├── store
│   ├── style
│   ├── utils
│   └── views
└── package.json
```

如果有接触过或者实际开发过一个 [h_ui](https://www.npmjs.com/package/h_ui) 项目的话会发现，这个目录结构和 [h_ui](https://www.npmjs.com/package/h_ui) 提供的模板工程非常类似，src 目录几乎完全一样。确实是的，[Arwen](https://www.npmjs.com/package/@arwen/arwen-cli) 在项目创建过程中也是基于模板来创建的，而这个模板就是 [h_ui](https://www.npmjs.com/package/h_ui) 官网提供的版本。

[Arwen](https://www.npmjs.com/package/@arwen/arwen-cli) 的目的是为了工程化，同时屏蔽掉对业务开发无关紧要的部分，这部分内容对普通的业务开发者来说往往有点儿超纲，不好理解。[Arwen](https://www.npmjs.com/package/@arwen/arwen-cli) 将这部分内容封装在了其 [h_ui](https://www.npmjs.com/package/h_ui) 项目模版的核心依赖 [h_ui-scripts](https://www.npmjs.com/package/@arwen/h_ui-scripts) 里面，这个依赖会在安装过程中作为开发期的依赖进行安装。除此之外，由 [Arwen](https://www.npmjs.com/package/@arwen/arwen-cli) 创建的 [h_ui](https://www.npmjs.com/package/h_ui) 项目和官网提供的模板工程真的没差！

# 运行期

执行 `arwen serve` 可以在开发模式下启动服务，并自动打开浏览器，同时的启动还有著名的 [HMR (Hot Module Replacement)](https://webpack.js.org/concepts/hot-module-replacement)。接下来就是业务编码的重头了，这个阶段的体验和 [h_ui](https://www.npmjs.com/package/h_ui) 提供的模板工程并没什么差别，src 目录下的任何改动都会引起一次 HMR。当有错误发生时，[Arwen](https://www.npmjs.com/package/@arwen/arwen-cli) 可以及时捕获并友好的输出在命令行内。运行过程如下：

![](/serve.png)

`arwen serve` 提供了两个命令行配置，`-p` 和 `-h`，不难猜出，他们是用来配置启动的域和端口的。在 [h_ui](https://www.npmjs.com/package/h_ui) 提供的模板工程中，域和端口的配置要写在配置文件中，很不灵活，而且很多人甚至都不知道这个配置的含义。当然，[Arwen](https://www.npmjs.com/package/@arwen/arwen-cli) 也支持将其配置在 `package.json` 中，不过并不推荐，有兴趣的话可以尝试。

# 编译打包

执行 `arwen build` 可以完成生产模式下的编译和打包工作。和 [h_ui](https://www.npmjs.com/package/h_ui) 提供的模板工程一样，编译打包的结果会存放在 `./build` 目录下。目录结构如下：

```javascript
./build/
├── index.html
├── static
│   ├── css
│   ├── fonts
│   ├── images
│   └── js
└── sysconfig.js
```

这个打包结果也并无太大出入。[Arwen](https://www.npmjs.com/package/@arwen/arwen-cli) 也保留了 `sysconfig.js` 作为生产环境运行期的全局配置文件。同时，对包括 `index.html` 在内的静态资源做了压缩和合并处理。在开启 `--debug` 模式后还会在生产环境开启 Source Map，方便测试。

[Arwen](https://www.npmjs.com/package/@arwen/arwen-cli) 还提供了 `--zip` 和 `--package-name` 配置。默认的打包不会创建 .zip 文件，而是将打包结果保存在 ./build 目录下。开启 `--zip` 之后，会创建 `--package-name` 指定文件名的 .zip 文件。

# 本地部署

[Arwen](https://www.npmjs.com/package/@arwen/arwen-cli) 目前只支持静态目录的本地部署，但有计划在近期的版本中支持远程部署，远程服务优先支持 [Nginx](http://nginx.org/en/)。本地部署可以用来验证与开发环境的一致性，以及近乎真实的生产环境的性能表现。通过执行 `arwen deploy <path>` 可以快速将 path 指定的文件目录部署到本地，如图：

![](/deploy-start.png)

`arwen deploy <path> [--port]` 可以用来指定要部署的端口，[Arwen](https://www.npmjs.com/package/@arwen/arwen-cli) 也提供了简单的进程管理。执行 `arwen deploy -s list` 可以列出当前本地部署的所有静态文件服务，如图：

![](deploy-list.png)

需要注意的是 id 字段。Id 可以用来唯一标识指定的服务，在执行 `arwen deploy -s stop --app-id 0` 命令时，指定一个明确的 Id 是被强烈推荐的，否则所有运行的服务都将被杀掉。

# 总结

[Arwen](https://www.npmjs.com/package/@arwen/arwen-cli) 目前所实现的功能还非常有限，还有许多需要优化的地方，更重要的，我并不想仅仅局限在基于 [h_ui](https://www.npmjs.com/package/h_ui) 组件的项目开发。[Arwen](https://www.npmjs.com/package/@arwen/arwen-cli) 将 [h_ui-scripts](https://www.npmjs.com/package/@arwen/h_ui-scripts) 单独剥离出来也是为了方便扩展更多的项目类型，这给 [Arwen](https://www.npmjs.com/package/@arwen/arwen-cli) 带来了无限的可能性。
