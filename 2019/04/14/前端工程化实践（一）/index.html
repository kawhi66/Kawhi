<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>前端工程化实践（一） | Kawhi's blogs</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/ARWEN/">ARWEN</a></div><div class="post-time">2019-04-14</div></div></div><div class="container post-header"><h1>前端工程化实践（一）</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">目录</summary><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#项目创建"><span class="toc-number">2.</span> <span class="toc-text">项目创建</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#运行期"><span class="toc-number">3.</span> <span class="toc-text">运行期</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#编译打包"><span class="toc-number">4.</span> <span class="toc-text">编译打包</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#本地部署"><span class="toc-number">5.</span> <span class="toc-text">本地部署</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-number">6.</span> <span class="toc-text">总结</span></a></li></ol></details></div><div class="container post-content"><p>最近几个月一直投入在公司一个 PC 端的 Web 项目上。在客户端部分，研发中心提供了基于 <a href="https://cn.vuejs.org/" target="_blank" rel="noopener">Vue</a> 的一个组件库 <a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 和配套运行的模板工程作为解决方案。从这段儿时间的体验来看，可以很明显的感觉到，一个传统的金融软件公司想做技术的转型还是要颇费一些周章的，即便是对核心的研发部门来说，与优秀的互联网企业相比也还有很远的距离。针对 <a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 项目在工程管理方面的一些表现，我想更好的解决方案是通过当下非常流行的脚手架来实现。</p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p><a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 是前端工程化的一个实践项目，目前的 <a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">arwen</a> 完全可以处理基于 <a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 的模板工程所开发的大部分单入口的项目。<a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 只有四个核心的命令，使用非常简单但却覆盖了应用管理的全生命周期，包括创建、编译、集成和部署。近乎傻瓜式的方式可以更好的屏蔽对业务编码无关紧要的部分，从而提高开发者的效率。截止文本，<a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 的最新版本是 0.1.3，要求 Node 的版本 &gt;= 10.X，可以通过 <code>npm install -gd @arwen/arwen-cli</code> 进行全局的安装。</p>
<h1 id="项目创建"><a href="#项目创建" class="headerlink" title="项目创建"></a>项目创建</h1><p>脚手架安装完成之后，执行 <code>arwen create h_ui-demo</code> 即可创建一个名为 h_ui-demo 的前端工程，在创建过程中，脚手架会自动完成目录检查，模板引入，依赖安装等工作，并以友好的方式给出每一步的安装提示。如图：</p>
<p><img src="/2019/04/14/前端工程化实践（一）/install.png" alt=""></p>
<p>需要注意的是，当网络环境较差时，安装过程可能要长一些。在安装完成之后，h_ui-demo 的目录结构如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">./h_ui-demo/</span><br><span class="line">├── README.md</span><br><span class="line">├── index.html</span><br><span class="line">├── sysconfig.js</span><br><span class="line">├── src</span><br><span class="line">│   ├── App.vue</span><br><span class="line">│   ├── main.js</span><br><span class="line">│   ├── api</span><br><span class="line">│   ├── assets</span><br><span class="line">│   ├── components</span><br><span class="line">│   ├── directive</span><br><span class="line">│   ├── mixins</span><br><span class="line">│   ├── mock</span><br><span class="line">│   ├── router</span><br><span class="line">│   ├── store</span><br><span class="line">│   ├── style</span><br><span class="line">│   ├── utils</span><br><span class="line">│   └── views</span><br><span class="line">└── package.json</span><br></pre></td></tr></table></figure>
<p>如果有接触过或者实际开发过一个 <a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 项目的话会发现，这个目录结构和 <a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 提供的模板工程非常类似，src 目录几乎完全一样。确实是的，<a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 在项目创建过程中也是基于模板来创建的，而这个模板就是 <a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 官网提供的版本。</p>
<p><a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 的目的是为了工程化，同时屏蔽掉对业务开发无关紧要的部分，这部分内容对普通的业务开发者来说往往有点儿超纲，不好理解。<a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 将这部分内容封装在了其 <a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 项目模版的核心依赖 <a href="https://www.npmjs.com/package/@arwen/h_ui-scripts" target="_blank" rel="noopener">h_ui-scripts</a> 里面，这个依赖会在安装过程中作为开发期的依赖进行安装。除此之外，由 <a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 创建的 <a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 项目和官网提供的模板工程真的没差！</p>
<h1 id="运行期"><a href="#运行期" class="headerlink" title="运行期"></a>运行期</h1><p>执行 <code>arwen serve</code> 可以在开发模式下启动服务，并自动打开浏览器，同时的启动还有著名的 <a href="https://webpack.js.org/concepts/hot-module-replacement" target="_blank" rel="noopener">HMR (Hot Module Replacement)</a>。接下来就是业务编码的重头了，这个阶段的体验和 <a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 提供的模板工程并没什么差别，src 目录下的任何改动都会引起一次 HMR。当有错误发生时，<a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 可以及时捕获并友好的输出在命令行内。运行过程如下：</p>
<p><img src="/2019/04/14/前端工程化实践（一）/serve.png" alt=""></p>
<p><code>arwen serve</code> 提供了两个命令行配置，<code>-p</code> 和 <code>-h</code>，不难猜出，他们是用来配置启动的域和端口的。在 <a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 提供的模板工程中，域和端口的配置要写在配置文件中，很不灵活，而且很多人甚至都不知道这个配置的含义。当然，<a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 也支持将其配置在 <code>package.json</code> 中，不过并不推荐，有兴趣的话可以尝试。</p>
<h1 id="编译打包"><a href="#编译打包" class="headerlink" title="编译打包"></a>编译打包</h1><p>执行 <code>arwen build</code> 可以完成生产模式下的编译和打包工作。和 <a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 提供的模板工程一样，编译打包的结果会存放在 <code>./build</code> 目录下。目录结构如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">./build/</span><br><span class="line">├── index.html</span><br><span class="line">├── <span class="keyword">static</span></span><br><span class="line">│   ├── css</span><br><span class="line">│   ├── fonts</span><br><span class="line">│   ├── images</span><br><span class="line">│   └── js</span><br><span class="line">└── sysconfig.js</span><br></pre></td></tr></table></figure>
<p>这个打包结果也并无太大出入。<a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 也保留了 <code>sysconfig.js</code> 作为生产环境运行期的全局配置文件。同时，对包括 <code>index.html</code> 在内的静态资源做了压缩和合并处理。在开启 <code>--debug</code> 模式后还会在生产环境开启 Source Map，方便测试。</p>
<p><a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 还提供了 <code>--zip</code> 和 <code>--package-name</code> 配置。默认的打包不会创建 .zip 文件，而是将打包结果保存在 ./build 目录下。开启 <code>--zip</code> 之后，会创建 <code>--package-name</code> 指定文件名的 .zip 文件。</p>
<h1 id="本地部署"><a href="#本地部署" class="headerlink" title="本地部署"></a>本地部署</h1><p><a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 目前只支持静态目录的本地部署，但有计划在近期的版本中支持远程部署，远程服务优先支持 <a href="http://nginx.org/en/" target="_blank" rel="noopener">Nginx</a>。本地部署可以用来验证与开发环境的一致性，以及近乎真实的生产环境的性能表现。通过执行 <code>arwen deploy &lt;path&gt;</code> 可以快速将 path 指定的文件目录部署到本地，如图：</p>
<p><img src="/2019/04/14/前端工程化实践（一）/deploy-start.png" alt=""></p>
<p><code>arwen deploy &lt;path&gt; [--port]</code> 可以用来指定要部署的端口，<a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 也提供了简单的进程管理。执行 <code>arwen deploy -s list</code> 可以列出当前本地部署的所有静态文件服务，如图：</p>
<p><img src="/2019/04/14/前端工程化实践（一）/deploy-list.png" alt=""></p>
<p>需要注意的是 id 字段。Id 可以用来唯一标识指定的服务，在执行 <code>arwen deploy -s stop --app-id 0</code> 命令时，指定一个明确的 Id 是被强烈推荐的，否则所有运行的服务都将被杀掉。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p><a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 目前所实现的功能还非常有限，还有许多需要优化的地方，更重要的，我并不想仅仅局限在基于 <a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 组件的项目开发。<a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 将 <a href="https://www.npmjs.com/package/@arwen/h_ui-scripts" target="_blank" rel="noopener">h_ui-scripts</a> 单独剥离出来也是为了方便扩展更多的项目类型，这给 <a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 带来了无限的可能性。</p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>