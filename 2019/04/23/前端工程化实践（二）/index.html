<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>前端工程化实践（二） | Kawhi's blogs</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/todo">Todo</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/ARWEN/">ARWEN</a></div><div class="post-time">2019-04-23</div></div></div><div class="container post-header"><h1>前端工程化实践（二）</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">目录</summary><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#远程部署"><span class="toc-number">2.</span> <span class="toc-text">远程部署</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#典型应用"><span class="toc-number">3.</span> <span class="toc-text">典型应用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a></li></ol></details></div><div class="container post-content"><p><a href="https://cli.vuejs.org/zh/" target="_blank" rel="noopener">@vue/cli</a> 和 <a href="https://facebook.github.io/create-react-app/" target="_blank" rel="noopener">create-react-app</a> 所支持的远程部署和部署环境有关，给出的解决方案都是针对特定的部署环境的。和 <a href="https://facebook.github.io/create-react-app/" target="_blank" rel="noopener">create-react-app</a> 类似，<a href="https://cli.vuejs.org/zh/" target="_blank" rel="noopener">@vue/cli</a> 针对几个开源的提供静态资源托管服务的环境给出了部署指引，比如 <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a>，<a href="https://docs.gitlab.com/" target="_blank" rel="noopener">GitLab Pages</a>，<a href="https://www.netlify.com/" target="_blank" rel="noopener">Netlify</a>，<a href="https://zeit.co/docs" target="_blank" rel="noopener">Now</a>，<a href="https://www.heroku.com/" target="_blank" rel="noopener">Heroku</a> 等等。<a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 所面向的部署场景不太一样。</p>
<p>注：<a href="https://cli.vuejs.org/zh/" target="_blank" rel="noopener">@vue/cli</a> 在 2.x 之后就不再更新了，在 3.x 的版本上推出了 <a href="https://cli.vuejs.org/zh/" target="_blank" rel="noopener">@vue/cli</a>，<a href="https://cli.vuejs.org/zh/" target="_blank" rel="noopener">@vue/cli</a> 其实是 <a href="https://cli.vuejs.org/zh/" target="_blank" rel="noopener">@vue/cli</a> 最新的解决方案。事实上，<a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 提供的模板工程很像是 <a href="https://cli.vuejs.org/zh/" target="_blank" rel="noopener">@vue/cli</a> 在 2.x 的基础上做 reject 之后的结果。</p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>很显然，我们不太可能将 <a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 的产品部署到开源环境，更适合 <a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 的部署方式是点对点的直接推送，在不考虑服务端缓存的情况下，这种方式无论在开发环境还是生产环境都适用。<a href="https://pm2.io/doc/en/runtime/guide/easy-deploy-with-ssh/" target="_blank" rel="noopener">PM2</a> 的远程部署方案 <a href="https://github.com/Unitech/pm2-deploy" target="_blank" rel="noopener">pm2-deploy</a> 可以做到这一点。<a href="https://github.com/Unitech/pm2-deploy" target="_blank" rel="noopener">pm2-deploy</a> 支持配置多个部署环境，执行 <code>pm2 deploy &lt;env&gt;</code> 可以将本地的静态资源轻松推送到远端。<a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 实现了与 <code>pm2 deploy &lt;env&gt;</code> 类似的功能，推送的处理参考了 <a href="https://www.npmjs.com/package/simple-ssh-deploy" target="_blank" rel="noopener">simple-ssh-deploy</a>。</p>
<h1 id="远程部署"><a href="#远程部署" class="headerlink" title="远程部署"></a>远程部署</h1><p><a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 在 V0.1.4 的版本中新增了 <code>arwen push &lt;env&gt;</code> 命令支持远程部署，<code>&lt;env&gt;</code> 的配置如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># ./package.json</span><br><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="string">"arwen"</span>: &#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"h_ui"</span>,                                <span class="comment">// 项目类型标识</span></span><br><span class="line">    <span class="string">"push_env"</span>: &#123;                                  <span class="comment">// 推送环境设置</span></span><br><span class="line">      <span class="string">"development"</span>: &#123;                             <span class="comment">// 开发环境</span></span><br><span class="line">        <span class="string">"auth"</span>: &#123;                                  <span class="comment">// ssh 连接配置，更多的配置项可以参考 https://github.com/mscdex/ssh2#client-methods  </span></span><br><span class="line">          <span class="string">"host"</span>: <span class="string">"192.168.0.1"</span>,</span><br><span class="line">          <span class="string">"port"</span>: <span class="string">"22"</span>,</span><br><span class="line">          <span class="string">"username"</span>: <span class="string">"kawhi"</span>,</span><br><span class="line">          <span class="string">"password"</span>: <span class="string">"*****"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"localFiles"</span>: <span class="string">"./build/**/*"</span>,              <span class="comment">// glob 定义的本地文件路径，这里表示 ./build 目录下的所有文件</span></span><br><span class="line">        <span class="string">"remotePath"</span>: <span class="string">"/home/kawhi/testtest"</span>,      <span class="comment">// 远端静态资源推送路径</span></span><br><span class="line">        <span class="string">"prePush"</span>: [                               <span class="comment">// 推送前在远端执行的命令集合</span></span><br><span class="line">          <span class="string">"rm -rf testtest"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"postPush"</span>: [                              <span class="comment">// 推送后在远端执行的命令集合</span></span><br><span class="line">          <span class="string">"ls -l ./testtest"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"silent"</span>: <span class="literal">true</span>                             <span class="comment">// 是否开启推送日志</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>设置 <code>silent</code> 为 true 可以打开推送日志，如果一切正常，执行 <code>arwen push development</code> 之后，会看到如下的内容：</p>
<p><img src="/2019/04/23/前端工程化实践（二）/push.png" alt=""></p>
<h1 id="典型应用"><a href="#典型应用" class="headerlink" title="典型应用"></a>典型应用</h1><p>目前的 <a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 项目多在用 <a href="http://nginx.org/" target="_blank" rel="noopener">nginx</a> 做静态资源服务和反向代理（当然，还有其他的应用）。在这种场景下，<code>arwen push &lt;env&gt;</code> 可以很方便的将编译集成后的静态文件资源推送到 <a href="http://nginx.org/" target="_blank" rel="noopener">nginx</a> 下指定的目录，实现静态资源的远程部署。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p><code>arwen push &lt;env&gt;</code> 实现的功能很单一，也很简单，有些类似的产品还实现了远端资源的版本管理，但我觉得这些功能在 <a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 项目中意义不大。推送的实现参考了 <a href="https://www.npmjs.com/package/simple-ssh-deploy" target="_blank" rel="noopener">simple-ssh-deploy</a> ，做了些优化和修改，但还是有些方法有待商榷。</p>
<p>不管怎么说，<a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 目前实现的功能已经比较完整了，后续会对项目创建所依赖的模板工程做些优化，同时扩展其他的项目类型。现在看来，其实 <a href="https://www.npmjs.com/package/h_ui" target="_blank" rel="noopener">h_ui</a> 对 <a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 来说意义不大，我希望 <a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 在不同的前端框架下都可以有解决方案，比如 <a href="https://www.reactjs.org/" target="_blank" rel="noopener">React</a>，<a href="https://angularjs.org/" target="_blank" rel="noopener">Angular</a>，甚至 <a href="https://jquery.com/" target="_blank" rel="noopener">jQuery</a> 等等等等。我还在考虑设计一套模板插件机制，在遵循统一的运行规范的基础上，允许任何一位开发者借助 <a href="https://www.npmjs.com/package/@arwen/arwen-cli" target="_blank" rel="noopener">Arwen</a> 开发自己的模板，希望有时间来做这些事情。</p>
</div></div><!-- .post-main.post-comment--><!--  include _partial/comments.pug--></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>